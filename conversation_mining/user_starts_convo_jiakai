from flask import Flask, render_template, jsonify, request
from pymongo import MongoClient
import pandas as pd
import numpy as np

app = Flask(__name__)


import airline_convo_starter


#then all these data folder must be at same level
data_folder_name: str = 'conversation' 
data_convo_mining_folder_name: str = 'convo_mining'
path: str = f'{data_convo_mining_folder_name}/../{data_folder_name}'
airline_convo_starter.clean_all_files(path)

# MongoDB connection
client = MongoClient("mongodb://localhost:27017/")
db = client.DBL

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/data')
def data():
    raw_data = list(db.raw_data.find())
    df = pd.DataFrame(raw_data)
    return df.to_json(orient='records')

@app.route('/clean_data', methods=['POST'])
def clean_data():
    raw_data = list(db.raw_data.find())
    df = pd.DataFrame(raw_data)

    # Example cleaning operations
    df.drop_duplicates(inplace=True)
    df.fillna(method='ffill', inplace=True)

    db.cleaned_data.delete_many({})
    db.cleaned_data.insert_many(df.to_dict('records'))
    return 'Data cleaned and saved to database'

if __name__ == '__main__':
    app.run(debug=True)